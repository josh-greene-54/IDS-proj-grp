---
title: "The Value of Life: A Macro Investigation of GDP and Life Expectancy Correlation"
author: 
  - Abigail Tata^[American University]
  - Kenneth Moreno^[American University]
  - Joshua Greene^[American University]
  - Fabiola Cruz^[American University]
format: 
  pdf:
    number-sections: true
    toc: false
    geometry: 
      - top=3cm
date: 2024-01-12
date-format: iso
documentclass: article
editor: source
abstract: "This paper seeks to investigate the relationship between GDP per capita and life expectancy rates worldwide. We do so by utilizing analytical techniques within R using 2017 data from the World Bank to help establish a statistically significant relationship between the dependent variable (life expectancy) and the independent variables (GDP per capita and healthcare expenditures) - we also include additional variables for control. The results show that GDP per capita and healthcare expenditures are statistically significant predictors of life expectancy."
bibliography: main.bib
---

```{r setup}
#| echo: false
#| message: false

library(stargazer)
library(Sleuth3)
library(tidyverse)
library(car)
library(mosaic)
library(ggthemes)
library(gmodels)
library(DescTools)
library(dplyr)
library(ggplot2)
library(tidyr)
library(tidymodels)
library(tidyr)
library(modelr)
library(rpart.plot)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
library(knitr)
library(estimatr)

```

```{r}
#| eval: false
#| echo: false
#| message: false

LE1 <- read_csv("countrydata.csv")

# read in income class data 
incomeclass <- read_csv("incomeclass.csv")


# take out NAs in the dataset 
LE1 <- na.omit(LE1)
sum(is.na(LE1$GDP.per.capita))
sum(is.na(LE1$Current.health.expenditure.per.capita))


# make all variables numeric 
LE1 <- LE1 %>%
  mutate(
    GDP.per.capita = as.numeric(as.character(GDP.per.capita)),
    Population = as.numeric(as.character(Population )),
    Life.expectancy = as.numeric(as.character(Life.expectancy)),
    Current.health.expenditure.per.gdp = as.numeric(as.character(Current.health.expenditure.per.gdp)),
    Current.health.expenditure.per.capita = as.numeric(as.character(Current.health.expenditure.per.capita)),
    Compulsory.education.duration = as.numeric(as.character(Compulsory.education.duration )),
    Birth.rate.p1000  = as.numeric(as.character(Birth.rate.p1000 )),
    Death.rate.p1000 = as.numeric(as.character(Death.rate.p1000 ))
)



# log  GDP
LE1$logGDP <- log(LE1$GDP.per.capita)
# log Current health expenditure per capita
LE1$logHCExpCapita <- log(LE1$Current.health.expenditure.per.capita)

#merge data
merged_df <- merge(incomeclass, LE1, by = "Country.Name")

```

```{r readdata}
#| eval: false
#| echo: false
#| message: false

# mutate class variable to long name and get rid of GDPrange

merged_df <- merged_df %>%
  select(-GDPrange)
merged_df <- merged_df %>%
  mutate(class = case_when(
    class == "L" ~ "Lower Income",
    class == "LM" ~ "Lower Middle Income",
    class == "UM" ~ " Upper Middle Income",
    class == "H" ~ "High Income"
  ))

#summary stats of the merged data set 
lm_out <- lm(Life.expectancy ~ logGDP, data = merged_df)
summary(lm_out)

#add residuals to data set 
merged_df <- merged_df %>%
  add_residuals(lm_out)

#add predictions to data set 
merged_df <- merged_df %>%
  add_predictions(lm_out)
merged_df$pred

```

# Introduction

One of the best indicators to measure socio-economic stability in a country is life expectancy, it not only helps us understand how countries are effectively providing basic services to citizens, but serves as a clue to the country’s overall governance infrastructure which can determine access to health care, jobs, education, crime rates, and much more. In addition, to fund the social services that a society needs to thrive, the country also needs to ensure a robust and thriving economy. Yet, even with a strong economy, disparities in quality of life and access to services can increase. In the United States for example @national_academies_of_sciences_growing_2015 illustrates how the gap between income and life expectancy has widened over recent decades. Thus, we seek to ask: Does a higher GDP per capita have an impact on life expectancy?       

We hypothesize that higher GDP per capita will have a direct effect on life expectancy. We believe that Countries with higher GDPs per capita have a higher life expectancy average compared to countries that have a lower GDP. For example, the quality of healthcare within the United States often relies on an individual's income @national_academies_of_sciences_growing_2015. Using data and statistical software, we aim to substantiate our claims that GDP per capita and life expectancy are directly correlated. We examined this relationship by pulling data on life expectancy and GDP per capita from the World Development Indicators [-@world_bank_world_2015]. When we measured for GDP per capita and life expectancy alone, we found a strong correlation between the two. While this initially proved our hypothesis, after expanding our research, we accounted for other independent factors like  Birth rate per 1000 people, current health expenditures (%GDP), inequality index, physicians per 1000 people, safe sanitation usage, current education expenditure, literacy rates, child immunization rates, incidence of HIV, incidence of TB, access to electricity, CO2 emissions, urban population, population density, internet usage, fertility rates, gender equality, poverty gap, poverty headcount ratio, income share, government expenditure on education, population - we then ran a multiple linear regression The regression showed that both healthcare expenditure and GDP per capita were incredibly significant within the model. A more detailed analysis of the theoretical evidence, the data, our methods, and the results are outlined below.       

# Framing the Conversation

Scholars have sought to understand how the economic status of nations around the world correlates with the health of their citizens since the late 1900s. Low-income nations often experience the highest mortality rates among their population, a phenomenon our research seeks to attribute to economic performance. Ultimately, studies done on the health outcomes of nations are often bogged down by the governance and statistical capacity deficits. Health issues are multidimensional, often incorporating social and economic factors that are hard to measure. However, the research is incredibly important to fully understand wealth and life expectancy disparities in society, in hopes that it leads us towards sustainable solutions. Through a deeper understanding of the ways in which these factors influence each other, we can better understand why some countries remain economically stagnant and why others prosper.        


While medicinal innovation has been booming since the late 1940s with the creation of organizations like the World Health Organization (WHO), many countries still lack the means to access lifesaving care. @acemoglu_disease_2007 argue that this inaccessibility affects life expectancy rates, leading to an unstable workforce and slow economic growth. Ultimately, the economic strain puts low-income countries out of the fighting ring for health resources. In order to address these issues, these nations routinely spend more time and resources on fertility, growing their population to make up for high mortality rates. However, @simona_relationship_2014 argues that this practice has the opposite effect and instead produces a population that the nation’s economy routinely fails to support, leading to further economic and health strains. Additionally, the international community has attempted several interventions to address the declining population in low-income countries. On occasion, global organizations like the UN supply temporary resources to developing nations. However, this fails to produce sustainable economic growth. Such unsuccessful efforts towards improving mortality rates and life expectancy is exactly why research into GDP per capita and life expectancy correlation is so vital. A clear, concise route to health improvement and economic prosperity starts with a base understanding of how these two factors continually rely on each other.        


Beyond domestic effects, the endurance of this discrepancy can also lead to geopolitical consequences. As argued by @national_academies_of_sciences_growing_2015, a gap between income and life expectancy globally has major implications for economic sustainability, eliciting fears of a quickly decreasing rate of global production due to a concentration of resources exclusive to the highest-earning nations. In times of global or regional conflict, the material differences between developing and developed countries are exacerbated as well. Whether or not the country has the resources to mitigate the suffering of their citizens in times of political strife is directly related to their economic capability.        


Inarguably, the implications of this research are vast. An informed understanding of the economic effects of mortality rates and overall health can lead to a more substantive response, helping ensure future economic stability and the upwards mobility of developing nations. Furthermore, it is important to note that this research does not only seek to draw focus on low-income nations but nations from middle to high-income as well. Measuring the relationship between GDP per capita, healthcare expenditures, and life expectancy has implications that go across the macro-economic spectrum. What follows is the collection and analysis of hard data from the World Bank, which supplements the conversation of the importance health outcomes have on economic prosperity – fostering what we hope to be a step towards a more sustainable solution to global health inequity.

# Data

The World Bank aggregates data from various sources on development indicators each year. This data accounts for 266 recognized countries and territories and encompasses many relevant fields of study, including economic development, healthcare, education, and more.

Our dataset was extracted from the World Bank's World Development Indicators database. We used data from 2017 for all 266 countries and territories, due to more recent years having more sizable gaps in data. The key outcome we accounted for is life expectancy at birth, measured in years. For our research, the key predictor of life expectancy was GDP per capita measured in US dollars in the year of 2015. To enhance our model, we examined several other independent variables.

As we reviewed preliminary figures and statistical tests of our indicators, we found that scatterplots of GDP were significantly skewed due to the wide range of the GDP data points. The way we overcame this issue was by logging two of the original columns Healthcare expenditure and GDP. The logging  process created a more normal distribution and allowed us to conduct statistical tests on the relationship between the independent and dependent variables. These two logged variables were then added to the data set to then be displayed in future visualizations.

```{r merged df data read}
#| echo: false
#| warning: false
#| message: false
#| include: false
LE1 <- read_csv("countrydata.csv")

# read in income class data 
incomeclass <- read_csv("incomeclass.csv")


# take out NAs in the dataset 
LE1 <- na.omit(LE1)
sum(is.na(LE1$GDP.per.capita))
sum(is.na(LE1$Current.health.expenditure.per.capita))


# make all variables numeric 
LE1 <- LE1 %>%
  mutate(
    GDP.per.capita = as.numeric(as.character(GDP.per.capita)),
    Population = as.numeric(as.character(Population )),
    Life.expectancy = as.numeric(as.character(Life.expectancy)),
    Current.health.expenditure.per.gdp = as.numeric(as.character(Current.health.expenditure.per.gdp)),
    Current.health.expenditure.per.capita = as.numeric(as.character(Current.health.expenditure.per.capita)),
    Compulsory.education.duration = as.numeric(as.character(Compulsory.education.duration )),
    Birth.rate.p1000  = as.numeric(as.character(Birth.rate.p1000 )),
    Death.rate.p1000 = as.numeric(as.character(Death.rate.p1000 ))
)



# log  GDP
LE1$logGDP <- log(LE1$GDP.per.capita)
# log Current health expenditure per capita
LE1$logHCExpCapita <- log(LE1$Current.health.expenditure.per.capita)

#merge data
merged_df <- merge(incomeclass, LE1, by = "Country.Name")
# mutate class variable to long name and get rid of GDPrange

merged_df <- merged_df %>%
  select(-GDPrange)
merged_df <- merged_df %>%
  mutate(class = case_when(
    class == "L" ~ "Lower Income",
    class == "LM" ~ "Lower Middle Income",
    class == "UM" ~ " Upper Middle Income",
    class == "H" ~ "High Income"
  ))

#summary stats of the merged data set 
lm_out <- lm(Life.expectancy ~ logGDP, data = merged_df)
summary(lm_out)

#add residuals to data set 
merged_df <- merged_df %>%
  add_residuals(lm_out)

#add predictions to data set 
merged_df <- merged_df %>%
  add_predictions(lm_out)
merged_df$pred


```

```{r histograms}
#| echo: false
#| warning: false
#| layout-ncol: 2
#| fig-cap: 
#|   - "GDP per Capita Distribution Before Log"
#|   - "LogGDP per Capita Distribution"
hist(merged_df$GDP.per.capita, xlab = 'GDP per Capita', ylab = 'Frequency', col = 'red', main = NULL)
hist(merged_df$logGDP, xlab = 'logGDP per Capita', ylab = 'Frequency', col = 'blue', main = NULL)

```

The analysis was conducted in `r paste(R.version$major, R.version$minor, sep = ".")` RStudio [-@rcoreteam]. 

We utilized the following R packages: stargazer, Sleuth3, tidyverse,car, mosaic, ggthemes, gmodels, DescTools,dplyr, ggplot2, tidyr, tidymodels,tidyr, modelr, rpart.plot, and sjPlot. Citations for each can be found at the end of this paper.

# Results

Our analysis sought to establish a significant correlation between the log of GDP per capita and life expectancy. A scatterplot of the data visually reveals what appears to be a positive correlation between the independent and dependent variables, as well as a clear division between the countries in each World Bank classification.

```{r dataframes}
#| echo: false
#| warning: false
#| message: false
#| include: false
LE1 <- read_csv("countrydata.csv")

# read in income class data 
incomeclass <- read_csv("incomeclass.csv")


# take out NAs in the dataset 
LE1 <- na.omit(LE1)
sum(is.na(LE1$GDP.per.capita))
sum(is.na(LE1$Current.health.expenditure.per.capita))


# make all variables numeric 
LE1 <- LE1 %>%
  mutate(
    GDP.per.capita = as.numeric(as.character(GDP.per.capita)),
    Population = as.numeric(as.character(Population )),
    Life.expectancy = as.numeric(as.character(Life.expectancy)),
    Current.health.expenditure.per.gdp = as.numeric(as.character(Current.health.expenditure.per.gdp)),
    Current.health.expenditure.per.capita = as.numeric(as.character(Current.health.expenditure.per.capita)),
    Compulsory.education.duration = as.numeric(as.character(Compulsory.education.duration )),
    Birth.rate.p1000  = as.numeric(as.character(Birth.rate.p1000 )),
    Death.rate.p1000 = as.numeric(as.character(Death.rate.p1000 ))
)



# log  GDP
LE1$logGDP <- log(LE1$GDP.per.capita)
# log Current health expenditure per capita
LE1$logHCExpCapita <- log(LE1$Current.health.expenditure.per.capita)

#merge data
merged_df <- merge(incomeclass, LE1, by = "Country.Name")
# mutate class variable to long name and get rid of GDPrange

merged_df <- merged_df %>%
  select(-GDPrange)
merged_df <- merged_df %>%
  mutate(class = case_when(
    class == "L" ~ "Lower Income",
    class == "LM" ~ "Lower Middle Income",
    class == "UM" ~ " Upper Middle Income",
    class == "H" ~ "High Income"
  ))

#summary stats of the merged data set 
lm_out <- lm(Life.expectancy ~ logGDP, data = merged_df)
summary(lm_out)

#add residuals to data set 
merged_df <- merged_df %>%
  add_residuals(lm_out)

#add predictions to data set 
merged_df <- merged_df %>%
  add_predictions(lm_out)
merged_df$pred
```

```{r ggplot}
#| echo: false
#| warning: false
#| message: false
ggplot(data = merged_df) + 
  geom_point(mapping = aes(x = logGDP, y = Life.expectancy)) + 
  geom_smooth(method = lm, mapping = aes(x = logGDP , y = Life.expectancy), se=FALSE)
  
#stargazer(lm_out, title = "Linear Regression of GDP and Life Expectancy", type = "text")

```

Below is a table showcasing linear regression.

```{r table}
#| echo: false
tab_model(lm_out, title = "Linear Regression of GDP and Life Expectancy")
```

Linear model testing further reveals a highly significant positive correlation between logGDP and life expectancy (p ~= 0). We find that each 1% increase in GDP per capita is correlated with a .0567-year difference in life expectancy. These findings support our hypothesis that GDP per capita has a positive correlation with life expectancy.

```{r}
#| tbl-cap: ANOVA Test for Different Classes
#| echo: false
#| message: false
#| warning: false
anova_result <- aov(logGDP ~ class, data = merged_df)
summary.aov(anova_result)
```

Examining the QQ plot of our data revealed a mostly normal distribution of residuals with a departure from normality in both extremes of the dataset. In a QQ plot, these extraneous points denote a separation between the theoretical distribution of normality and the observed residuals from the linear model. To address this disparity, we chose to test the data for heteroskedasticity using the estimatr package in R. A comparison between our standard linear model and the robust model showed a slight decrease in standard error while maintaining the same coefficient, which both models labelled as highly significant. Thus, accounting for heteroskedasticity did not have a significant effect on our model, as our data showed robustness to the adjustment.

```{r plot}
#| echo: false
#| message: false

edulm<-lm(LE1$Life.expectancy~LE1$logGDP)
qq_plot <- plot(edulm, which = 2, main = "Normal Q-Q Plot")
```

Below is a table of our Robust Model. 

```{r robus}
lm_robusted <- lm_robust(Life.expectancy ~ logGDP, data = merged_df)
tab_model(lm_robusted, title = "Robust Model")
```


To expand the framework of our model, we applied a multiple linear regression model to our dataset to test the significance of GDP per capita against life expectancy when exposed to the influence of other independent variables. Our added predictors included the log of healthcare expenditure per capita, population, and compulsory education duration (years). These results align with Simpson's paradox, and therefore suggest that GDP per capita may have been confounded in the multiple linear regression model, or the model was influenced by multicollinearity. We found that GDP per capita and healthcare expenditures were highly significant in predicting life expectancy.

```{r model}
#| echo: false
#| message: false
#| warning: false

model1 <- lm(Life.expectancy ~ logGDP + logHCExpCapita + Population + Compulsory.education.duration, data = merged_df)

tab_model(model1, title = "Multi-factor Linear Model")
```

Our final model of analysis was a decision tree predictive model made with the rpart package. The goal of this model was to predict life expectancy given the logarithm of any GDP per capita and healthcare expenditures. The dataset was split via a training:testing ratio of 70:30, and the model was tasked with determining predictions in the form of linear regression. This model exemplifies the statistical significance of healthcare expenditures and GDP per capita in predicting life expectancuy. 

For example, if we began at the top of the model with France, whose logHealthcare expenditures is 8.3, translating to just over \$5,071 per capita, we determine that this country does not fall under the 6.4 limit. Thus, we continue to the next branch where we compare logGDP per capita. France has a logGDP of 10.7 or \$44,577 per capita. This puts them over 10 and thus predicts the life expectancy to be 81. Following the same method for other countries produces the same outcome: a prediction on life expectancy based GDP and healthcare expenditures per capita.


```{r decision tree data}
#| echo: false
#| warning: false
#| message: false
#| include: false
set.seed(123)  # Setting a seed for reproducibility
split <- initial_split(merged_df, prop = 0.7, strata = Life.expectancy)
train_data <- training(split)
test_data <- testing(split)

# Create a decision tree model using the 'rpart' package
tree_model <- decision_tree() %>%
  set_engine("rpart") %>%
  set_mode("regression")

# Train the model
trained_model <- tree_model %>% fit(Life.expectancy ~ logGDP+logHCExpCapita, data = train_data)
# Make predictions on the test set
predictions <- predict(trained_model, new_data = test_data)
# View the predictions
print(predictions)

```

```{r decision tree}
#| echo: false
#| warning: false
#| message: false

#visualize tree
rpart.plot(trained_model$fit, roundint = FALSE)

predict_life_expectancy <- function(trained_model, log_gdp_value, log_hc_exp_value) {
  new_data <- data.frame(logGDP = log_gdp_value, logHCExpCapita = log_hc_exp_value)
  new_predictions <- predict(trained_model, new_data)
  new_predictions <- as.numeric(new_predictions[[1]])
  GDP <- exp(log_gdp_value)
  cat(" Countrys GDP", GDP, "\n")
  cat("Predicted Average Life Expectancy:", new_predictions, "\n")
  return(list(PredictedLifeExpectancy = new_predictions))
}

```

# Future Implications

In undertaking this topic, we aimed to find and measure a correlation between GDP per capita and life expectancy around the world. Understanding how these two factors influence each other is the keystone to tackling significant global issues, like poverty and high mortality rates. We found that measured on their own, GDP per capita and life expectancy had a strong correlation: the higher the GDP per capita, the higher the life expectancy. We had predicted this outcome early on, attributing the relationship to a country’s access or lack of access to life-sustaining resources and quality of life.       


Throughout this research, we developed a working theory as to what all this research means. Countries with low GDP per capita lacked the resources to sustain their population, thus leading to high mortality rates. As @simona_relationship_2014 argued, high mortality rates incentivized citizens to focus on fertility to “make up” for the deaths. This, however, adds strain to an economy that is already unable to support its current population. Thus, more of the population is left economically stratified in poor living conditions, heightening the risk of death to preventable illness or disease. An unsustainable population means an unsustainable workforce, leading to the limited production, innovation, and a lack of participation in the national economy, culminating in a low GDP per capita. This cycle is doomed to continue to repeat itself.        


This research was limited in some ways. We did not account for a country's socio-cultural issues, for example levels of inequality among a country's population. As stated before, many factors that contribute to a country’s life expectancy are notoriously multidimensional and are difficult to measure. Ultimately, our topic focused on the factors we could accurately attest for – GDP per capita and healthcare expenditures – and we discovered that GDP per capita and healthcare expenditures were both statistically significant.       


Undoubtedly, this topic is broad and nuanced. In future replications of this research, one should be cognizant of the historical and geopolitical factors that contribute to a country’s life expectancy or GDP per capita. While we found relationships that are significant and important, a holistic approach to this topic has the possibility of producing a meaningful report of the issues plaguing low-income countries. It also has the potential to be incredibly beneficial in informing future international economic policy and the mitigation of risk for high-income countries. While our research was limited in scope, we hope it contributes to a broader conversation on health and overall socio-economic equity.

\clearpage

# References

---
nocite: |
  @*
---

